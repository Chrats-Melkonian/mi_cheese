---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}

#libraries
library(tidyverse)
library(ggalluvial)

#working dir
setwd("~/Downloads/embl_mac/documents/cheeseTranscriptomics/chrats2")

#data
#smetana_cheese=read.delim("sim_summary.tsv",header=TRUE)
smetana_cheese=read.delim("sim_nofe_summary.tsv",header=TRUE)

#average smetana scores across simulations grouping by donor receiver and compound
smetana_cheese %>% 
  group_by(compound,receiver,donor) %>% 
  mutate(ave_smet = mean(smetana), sd_smet=sd(smetana)) %>% 
  dplyr::select(-community,-medium,-scs,-mus,-mps,-smetana) %>% 
  unique() %>%
  filter(ave_smet!=0) -> data

#subset mets
data %>% filter(ave_smet>=0.1) %>% ungroup() %>% dplyr::select(compound) %>% unique() -> mets

#plot
ggplot(data %>% filter(compound %in% mets$compound),
       aes(axis1 = donor, axis2 = compound, axis3 = receiver,
           y = ave_smet)) +
    scale_x_discrete(limits = c("Donor", "Metabolite", "Reciever")) +
    xlab("Interaction") +
    geom_alluvium(aes(fill = compound)) +
    geom_stratum(width=0.3) +
    theme_minimal() + geom_text(stat = "stratum", aes(label = after_stat(stratum)),min.y=0.2)+theme_bw() + 
    theme(panel.border = element_blank(), panel.grid.major = element_blank(),panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),axis.line.y = element_blank(),axis.ticks.y = element_blank(),axis.text.y = element_blank(),axis.title.y = element_blank(),axis.line.x = element_blank(),axis.ticks.x = element_blank())

ggsave("smetana.pdf",height = 8,width = 12)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

